package main;

import java.awt.AWTException;
import java.awt.Robot;
import java.awt.event.KeyEvent;
import java.io.File;
import java.io.IOException;
import java.util.Random;

public class Utilities {
	
	public static boolean checkForGM() throws AWTException, InterruptedException {
		
		Robot robot = new Robot();
		
		Random dice = new Random();
		
		// Enter
		int enterKey = KeyEvent.VK_ENTER;
		robot.keyPress(enterKey);
		robot.delay(dice.nextInt(100));
		robot.keyRelease(enterKey);
		
		// Slash
		int shiftKey = KeyEvent.VK_SHIFT;
		int sevenKey = KeyEvent.VK_7;
		robot.keyPress(shiftKey);
		robot.keyPress(sevenKey);
		robot.delay(dice.nextInt(100));
		robot.keyRelease(sevenKey);
		robot.keyRelease(shiftKey);

		// W
		int w_key = KeyEvent.VK_W;
		robot.keyPress(w_key);
		robot.delay(dice.nextInt(100));
		robot.keyRelease(w_key);
		
		// H
		int h_key = KeyEvent.VK_H;
		robot.keyPress(h_key);
		robot.delay(dice.nextInt(100));
		robot.keyRelease(h_key);
		
		// O
		int o_key = KeyEvent.VK_O;
		robot.keyPress(o_key);
		robot.delay(dice.nextInt(100));
		robot.keyRelease(o_key);
		
		// Enter
		robot.keyPress(enterKey);
		robot.delay(dice.nextInt(100));
		robot.keyRelease(enterKey);
		
		// Enter
		robot.keyPress(enterKey);
		robot.delay(dice.nextInt(100));
		robot.keyRelease(enterKey);
		
		Thread.sleep(200);
		
		String log_file_name = "C:\\Users\\zimtx\\AppData\\Roaming\\PSExtended\\characters\\Huarwar\\logs_system.txt";
		File log_file = new File(log_file_name);
		
		String data = readLastXLinesOfFile(log_file, 200);
		
		if(data.contains("Players Currently Online")) {
			data = data.substring(data.indexOf("Players Currently Online"));
		}
		
		System.out.println(data);
		
		if(data.toLowerCase().contains("game master") || data.toLowerCase().contains("gm")) {
			return true;
		} else {
			return false;
		}
		
	}
	
	public static String readLastXLinesOfFile( File file, int lines) {
	    java.io.RandomAccessFile fileHandler = null;
	    try {
	        fileHandler = 
	            new java.io.RandomAccessFile( file, "r" );
	        long fileLength = fileHandler.length() - 1;
	        StringBuilder sb = new StringBuilder();
	        int line = 0;

	        for(long filePointer = fileLength; filePointer != -1; filePointer--){
	            fileHandler.seek( filePointer );
	            int readByte = fileHandler.readByte();

	             if( readByte == 0xA ) {
	                if (filePointer < fileLength) {
	                    line = line + 1;
	                }
	            } else if( readByte == 0xD ) {
	                if (filePointer < fileLength-1) {
	                    line = line + 1;
	                }
	            }
	            if (line >= lines) {
	                break;
	            }
	            sb.append( ( char ) readByte );
	        }

	        String lastLine = sb.reverse().toString();
	        return lastLine;
	    } catch( java.io.FileNotFoundException e ) {
	        e.printStackTrace();
	        return null;
	    } catch( java.io.IOException e ) {
	        e.printStackTrace();
	        return null;
	    }
	    finally {
	        if (fileHandler != null )
	            try {
	                fileHandler.close();
	            } catch (IOException e) {
	            }
	    }
	}

}
